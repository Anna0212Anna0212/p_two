<!DOCTYPE html>  <!-- 管理後台 -->
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>管理後台</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family:"微軟正黑體", sans-serif; padding:2rem; background:#f0f0f0; }
table { width:100%; border-collapse:collapse; background:white; }
th, td { border:1px solid #ccc; padding:0.5rem; text-align:center; }
th { background:#6a9fb5; color:white; }
button { margin:0 2px; }
</style>
</head>
<body>
<h2>管理後台 - 訂位資料</h2>
<table id="reservationTable">
    <thead>
        <tr>
            <th>姓名</th><th>電話</th><th>Email</th><th>日期</th><th>時間</th>
            <th>人數</th><th>區域</th><th>備註</th><th>狀態</th><th>建立時間</th><th>操作</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
// 檢查是否為管理員
if(localStorage.getItem("isAdmin")!=="true"){
    alert("您不是管理員！");
    window.location.href="adminLogin.html";
}

// 讀取資料
function renderTable(){
    const reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
    const tbody = document.querySelector("#reservationTable tbody");
    tbody.innerHTML="";
    reservations.forEach((r,i)=>{
        tbody.innerHTML += `
        <tr>
            <td contenteditable>${r.name}</td>
            <td contenteditable>${r.phone}</td>
            <td contenteditable>${r.email}</td>
            <td contenteditable>${r.date}</td>
            <td contenteditable>${r.time}</td>
            <td contenteditable>${r.people}</td>
            <td contenteditable>${r.area}</td>
            <td contenteditable>${r.note}</td>
            <td contenteditable>${r.status}</td>
            <td>${r.created_at}</td>
            <td>
                <button onclick="update(${i})" class="btn btn-success btn-sm">更新</button>
                <button onclick="del(${i})" class="btn btn-danger btn-sm">刪除</button>
            </td>
        </tr>
        `;
    });
}

function update(index){
    const table = document.querySelector("#reservationTable tbody");
    const row = table.rows[index];
    // 驗證電話與 Email
    const phone = row.cells[1].innerText.trim();
    const email = row.cells[2].innerText.trim();
    const phoneRegex = /^09\d{8}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if(!phoneRegex.test(phone)){
        alert("電話格式錯誤");
        return;
    }
    if(!emailRegex.test(email)){
        alert("Email格式錯誤");
        return;
    }

    let reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
    reservations[index] = {
        name: row.cells[0].innerText.trim(),
        phone: phone,
        email: email,
        date: row.cells[3].innerText.trim(),
        time: row.cells[4].innerText.trim(),
        people: row.cells[5].innerText.trim(),
        area: row.cells[6].innerText.trim(),
        note: row.cells[7].innerText.trim(),
        status: row.cells[8].innerText.trim(),
        created_at: row.cells[9].innerText.trim()
    };
    localStorage.setItem("reservations", JSON.stringify(reservations));
    alert("資料已更新");
    renderTable();
}

function del(index){
    if(confirm("確定要刪除這筆資料嗎？")){
        let reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
        reservations.splice(index,1);
        localStorage.setItem("reservations", JSON.stringify(reservations));
        renderTable();
    }
}

renderTable();
</script>
</body>
</html>
