<!DOCTYPE html> <!-- 管理後台 -->
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>管理後台</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family:"微軟正黑體", sans-serif; padding:2rem; background:#f0f0f0; }
h2 { margin-top:1.5rem; }
table { width:100%; border-collapse:collapse; background:white; }
th, td { border:1px solid #ccc; padding:0.5rem; text-align:center; }
th { background:#6a9fb5; color:white; }
button { margin:0 2px; }
.tab-buttons { margin-bottom:1rem; }
</style>
</head>
<body>

<h1>管理後台</h1>
<div class="tab-buttons">
    <button class="btn btn-primary" onclick="showTab('reservations')">訂位資料</button>
    <button class="btn btn-success" onclick="showTab('messages')">聯絡訊息</button>
    <button class="btn btn-warning" onclick="showTab('users')">會員資料</button>
</div>

<!-- 訂位資料 -->
<div id="reservations" class="tab">
    <h2>訂位資料</h2>
    <table id="reservationTable">
        <thead>
            <tr>
                <th>姓名</th><th>電話</th><th>Email</th><th>日期</th><th>時間</th>
                <th>人數</th><th>區域</th><th>備註</th><th>狀態</th><th>建立時間</th><th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- 聯絡管理員訊息 -->
<div id="messages" class="tab" style="display:none;">
    <h2>聯絡訊息</h2>
    <table id="messageTable">
        <thead>
            <tr>
                <th>姓名</th><th>Email</th><th>訊息</th><th>時間</th><th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- 使用者資料 -->
<div id="users" class="tab" style="display:none;">
    <h2>會員資料</h2>
    <table id="userTable">
        <thead>
            <tr>
                <th>使用者名稱</th><th>Email</th><th>密碼(加密)</th><th>操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
// 檢查管理員身份
if(localStorage.getItem("isAdmin")!=="true"){
    alert("您不是管理員！");
    window.location.href="adminLogin.html";
}

// 頁籤切換
function showTab(tabName){
    document.querySelectorAll(".tab").forEach(t=>t.style.display="none");
    document.getElementById(tabName).style.display="block";
}

// 訂位資料載入
function renderReservations(){
    const reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
    const tbody = document.querySelector("#reservationTable tbody");
    tbody.innerHTML = reservations.map((r,i)=>`
        <tr>
            <td contenteditable>${r.name}</td>
            <td contenteditable>${r.phone}</td>
            <td contenteditable>${r.email}</td>
            <td contenteditable>${r.date}</td>
            <td contenteditable>${r.time}</td>
            <td contenteditable>${r.people}</td>
            <td contenteditable>${r.area}</td>
            <td contenteditable>${r.note}</td>
            <td contenteditable>${r.status}</td>
            <td>${r.created_at}</td>
            <td>
                <button onclick="updateReservation(${i})" class="btn btn-success btn-sm">更新</button>
                <button onclick="deleteReservation(${i})" class="btn btn-danger btn-sm">刪除</button>
            </td>
        </tr>
    `).join("");
}

function updateReservation(index){
    const row = document.querySelector("#reservationTable tbody").rows[index];
    const phone = row.cells[1].innerText.trim();
    const email = row.cells[2].innerText.trim();
    if(!/^09\d{8}$/.test(phone)){ alert("電話格式錯誤"); return; }
    if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ alert("Email格式錯誤"); return; }

    let reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
    reservations[index] = {
        name: row.cells[0].innerText.trim(),
        phone, email,
        date: row.cells[3].innerText.trim(),
        time: row.cells[4].innerText.trim(),
        people: row.cells[5].innerText.trim(),
        area: row.cells[6].innerText.trim(),
        note: row.cells[7].innerText.trim(),
        status: row.cells[8].innerText.trim(),
        created_at: row.cells[9].innerText.trim()
    };
    localStorage.setItem("reservations", JSON.stringify(reservations));
    alert("資料已更新");
    renderReservations();
}

function deleteReservation(index){
    if(confirm("確定刪除這筆訂位？")){
        let reservations = JSON.parse(localStorage.getItem("reservations") || "[]");
        reservations.splice(index,1);
        localStorage.setItem("reservations", JSON.stringify(reservations));
        renderReservations();
    }
}

// 聯絡訊息載入
function renderMessages(){
    const messages = JSON.parse(localStorage.getItem("contactMessages") || "[]");
    const tbody = document.querySelector("#messageTable tbody");
    tbody.innerHTML = messages.map((m,i)=>`
        <tr>
            <td>${m.name}</td>
            <td>${m.email}</td>
            <td>${m.message}</td>
            <td>${m.time}</td>
            <td><button class="btn btn-danger btn-sm" onclick="deleteMessage(${i})">刪除</button></td>
        </tr>
    `).join("");
}
function deleteMessage(index){
    let messages = JSON.parse(localStorage.getItem("contactMessages") || "[]");
    messages.splice(index,1);
    localStorage.setItem("contactMessages", JSON.stringify(messages));
    renderMessages();
}

// 使用者資料載入（假設存在 localStorage "users"）
function renderUsers(){
    const users = JSON.parse(localStorage.getItem("users") || "[]");
    const tbody = document.querySelector("#userTable tbody");
    tbody.innerHTML = users.map((u,i)=>`
        <tr>
            <td>${u.username}</td>
            <td>${u.email}</td>
            <td>${u.password}</td>
            <td><button class="btn btn-info btn-sm" onclick="alert('該使用者可用Email找回密碼')">提示</button></td>
        </tr>
    `).join("");
}

// 初始化
renderReservations();
renderMessages();
renderUsers();
</script>
</body>
</html>
